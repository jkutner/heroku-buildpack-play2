#!/usr/bin/env bash
# bin/release <build-dir>

BIN_DIR=$(cd $(dirname $0); pwd)
. $BIN_DIR/common
BUILD_DIR=$1

SBT_USER_HOME=".sbt_home"
SBT_USER_HOME_ABSOLUTE="$BUILD_DIR/$SBT_USER_HOME"

JAVA_OPTS="-Xms768M -Xmx1024M -XX:MaxPermSize=512M -XX:+CMSClassUnloadingEnabled"
JAVA_OPTS="$JAVA_OPTS -Dfile.encoding=UTF8 -Dsbt.log.noformat=true"
JAVA_OPTS="$JAVA_OPTS -Duser.home=$SBT_USER_HOME_ABSOLUTE"
JAVA_OPTS="$JAVA_OPTS -Divy.default.ivy.user.dir=$SBT_USER_HOME_ABSOLUTE/.ivy2"
JAVA_OPTS="$JAVA_OPTS -Dsbt.global.base=$SBT_USER_HOME_ABSOLUTE"

cat <<EOF
---
config_vars:
  PATH: .jdk/bin:/usr/local/bin:/usr/bin:/bin
  JAVA_OPTS: $JAVA_OPTS
  HOME: $SBT_USER_HOME_ABSOLUTE
addons:
  heroku-postgresql:dev

EOF

if [ ! -f $BUILD_DIR/Procfile ]; then
# cat <<EOF
# default_process_types:
#   $(universal_packaging_default_web_proc $BUILD_DIR)
# EOF
cat <<EOF
default_process_types:
  web: ./activator start -Dhttp.port=\$PORT
EOF
fi
